# æ™ºæ…§åšç‰©é¦†åç«¯ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

æ™ºæ…§åšç‰©é¦†åç«¯ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„ç°ä»£åŒ–åšç‰©é¦†ç®¡ç†å¹³å°ï¼Œé›†æˆäº†ç‰©è”ç½‘ã€äººå·¥æ™ºèƒ½ã€æ•°å­—åŒ–ç¥¨åŠ¡ç­‰å¤šç§æŠ€æœ¯ï¼Œä¸ºåšç‰©é¦†æä¾›æ™ºèƒ½åŒ–çš„ç¯å¢ƒç›‘æ§ã€è®¾å¤‡æ§åˆ¶ã€ç”¨æˆ·ç®¡ç†å’Œç¥¨åŠ¡æœåŠ¡ã€‚

## ğŸŒŸ ä¸»è¦ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ**ï¼šæ”¯æŒç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†ï¼Œä¸“å®¶ç”¨æˆ·éœ€æ¿€æ´»ç éªŒè¯
- **ç¯å¢ƒç›‘æ§**ï¼šå®æ—¶ç›‘æ§åšç‰©é¦†å„æˆ¿é—´çš„æ¸©åº¦ã€æ¹¿åº¦ã€å…‰ç…§ã€æ°”ä½“ç­‰ç¯å¢ƒæ•°æ®
- **æ™ºèƒ½è®¾å¤‡æ§åˆ¶**ï¼šé€šè¿‡ MQTT åè®®æ§åˆ¶é£æ‰‡ã€ç¯å…‰ç­‰è®¾å¤‡ï¼Œæ”¯æŒæ‰‹åŠ¨å’Œ AI è‡ªåŠ¨æ§åˆ¶
- **æ•°å­—åŒ–ç¥¨åŠ¡**ï¼šäºŒç»´ç ç¥¨åŠ¡ç”Ÿæˆã€éªŒè¯ã€ç»Ÿè®¡ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–å…¥é¦†ç®¡ç†
- **AI æ™ºèƒ½åŠ©æ‰‹**ï¼šé›†æˆ MaxKBï¼Œæä¾›æ™ºèƒ½é—®ç­”å’Œè®¾å¤‡æ§åˆ¶å»ºè®®
- **æ•°æ®ç»Ÿè®¡åˆ†æ**ï¼šæ¯æ—¥å…¥é¦†äººæ•°ç»Ÿè®¡ã€ç¯å¢ƒæ•°æ®åˆ†æ

### æŠ€æœ¯äº®ç‚¹
- **åˆ†å±‚æ¶æ„è®¾è®¡**ï¼šæ¸…æ™°çš„ MVC æ¶æ„ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **åŠ¨æ€æˆ¿é—´ç®¡ç†**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶å®ç°æˆ¿é—´æ•°é‡çš„çµæ´»æ‰©å±•
- **é«˜å¹¶å‘ä¼˜åŒ–**ï¼šRedis ç¼“å­˜ + åŸå­æ“ä½œä¿è¯æ•°æ®ä¸€è‡´æ€§
- **ç‰©è”ç½‘é›†æˆ**ï¼šMQTT åè®®å®ç°è®¾å¤‡å®æ—¶é€šä¿¡
- **å®‰å…¨è®¤è¯**ï¼šJWT + é‚®ç®±éªŒè¯ç  + æ¿€æ´»ç å¤šé‡å®‰å…¨ä¿éšœ

## å®è·µå±•ç¤º
![alt text](c54c4ea4a0ef83dcf731a91d31350242.png)
![alt text](62dda82c7a0b86766ba07e7ddaa21c88.png)
![alt text](5d44f59b9ec1d4cd2b9db53e42f7809e.png)
![alt text](9e0cb61ecffd825e83dbe04b3c0ba18c.png)
![alt text](860202a574621cab20c2330a4ad014b8.png)
![alt text](a0cd496541c3d492ae6a838ecb0b65fd.png)
![alt text](4ad04a1fb8e7b29b0f7cd49036f43284.png)
![alt text](69ff61bff3ed66995cc8cce818c6fb2b.png)
![alt text](197faefa32fc1c7e1c6b076747329876.png)
![alt text](94d898fea30667a511e878ad86580117.png)
![alt text](3c694294efe834c0ce00ece418af8bac.png)

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”œâ”€â”€ controller/          # æ§åˆ¶å™¨å±‚ - å¤„ç† HTTP è¯·æ±‚
â”œâ”€â”€ service/            # æœåŠ¡å±‚ - ä¸šåŠ¡é€»è¾‘å¤„ç†
â”œâ”€â”€ dao/                # æ•°æ®è®¿é—®å±‚ - æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹ - ç»“æ„ä½“å®šä¹‰
â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶ - JWT è®¤è¯ç­‰
â”œâ”€â”€ my_init/           # åˆå§‹åŒ–æ¨¡å— - ç³»ç»Ÿå¯åŠ¨é…ç½®
â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”œâ”€â”€ test/              # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ qrcodes/           # äºŒç»´ç å­˜å‚¨ç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.24.5+
- MySQL 8.0+
- Redis 6.0+
- MQTT Broker (æ¨è EMQX)

### å®‰è£…ä¾èµ–

```bash
go mod tidy
```

### é…ç½®æ–‡ä»¶

è‡ªè¡Œå¡«å…… `config/config.yaml`


### è¿è¡Œé¡¹ç›®

```bash
go run main.go
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨

## ğŸ”§ å…³é”®æŠ€æœ¯å®ç°

### 1. é«˜å¹¶å‘æ•°æ®ä¸€è‡´æ€§

é¡¹ç›®ä½¿ç”¨ Redis åŸå­æ“ä½œå¤„ç†é«˜é¢‘æ•°æ®ï¼Œå¦‚æ¯æ—¥å…¥é¦†ç»Ÿè®¡ï¼š

```go
// åŸå­æ€§å¢åŠ å…¥é¦†äººæ•°
RedisClient.Incr(context, config.TOTAL_NUM)

// å®šæ—¶ä»»åŠ¡åŒæ­¥åˆ° MySQL
func StartDailyEntryCountJob() {
    c := cron.New()
    c.AddFunc("0 0 * * *", func() {
        count, _ := service.RedisClient.Get(ctx, config.TOTAL_NUM).Int()
        dao.InsertNewDailyEntryCount(count)
        service.RedisClient.Set(ctx, config.TOTAL_NUM, 0, 0)
    })
    c.Start()
}
```

### 2. åŠ¨æ€æˆ¿é—´ç®¡ç†

é€šè¿‡é…ç½®æ–‡ä»¶å®ç°æˆ¿é—´çš„åŠ¨æ€æ‰©å±•ï¼š

```go
// é…ç½®è§£æ
type AppConfig struct {
    RoomMapping map[string]string `mapstructure:"room_mapping"`
}

// åŠ¨æ€è¡¨å
func (Environment) TableName(roomName string) string {
    return config.AppConfigInstance.RoomMapping[roomName]
}
```

### 3. MQTT ç‰©è”ç½‘é›†æˆ

```go
// è®¢é˜…ç¯å¢ƒæ•°æ®
func CollectDataFromHardware(topic string) {
    service.SubscribeMQTT(topic, func(client MQTT.Client, msg MQTT.Message) {
        var data EnvironmentData
        json.Unmarshal(msg.Payload(), &data)
        // å¤„ç†ç¯å¢ƒæ•°æ®å¹¶å­˜å‚¨
        controller.CreateEnvironmentByRoom(data.Room, &env)
    })
}
```

### 4. JWT å®‰å…¨è®¤è¯

```go
// JWT ä¸­é—´ä»¶
func JWTAuthMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        authHeader := c.GetHeader("Authorization")
        if !strings.HasPrefix(authHeader, "Bearer ") {
            c.JSON(401, gin.H{"error": "æœªæºå¸¦token"})
            c.Abort()
            return
        }
        // éªŒè¯ token
        token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {
            return jwtKey, nil
        })
        if err != nil || !token.Valid {
            c.JSON(401, gin.H{"error": "tokenæ— æ•ˆ"})
            c.Abort()
            return
        }
        c.Next()
    }
}
```

## ğŸ“Š é¡¹ç›®éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 1. å¤šæˆ¿é—´åŠ¨æ€æ‰©å±•
**éš¾ç‚¹**ï¼šä¸åŒåšç‰©é¦†æˆ¿é—´æ•°é‡ä¸åŒï¼Œéœ€è¦æ”¯æŒçµæ´»é…ç½®
**è§£å†³**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ˜ å°„ + åŠ¨æ€è¡¨ç»“æ„ï¼Œå®ç°é›¶ä»£ç ä¿®æ”¹çš„æˆ¿é—´æ‰©å±•

### 2. é«˜å¹¶å‘æ•°æ®ä¸€è‡´æ€§
**éš¾ç‚¹**ï¼šå…¥é¦†ç»Ÿè®¡ç­‰é«˜é¢‘æ“ä½œå®¹æ˜“å‡ºç°æ•°æ®ä¸ä¸€è‡´
**è§£å†³**ï¼šRedis åŸå­æ“ä½œ + å®šæ—¶åŒæ­¥ï¼Œä¿è¯æ€§èƒ½å’Œä¸€è‡´æ€§

### 3. ç¡¬ä»¶ä¸ AI é›†æˆ
**éš¾ç‚¹**ï¼šç‰©è”ç½‘è®¾å¤‡æ§åˆ¶ + AI æ™ºèƒ½å†³ç­–çš„æŠ€æœ¯èåˆ
**è§£å†³**ï¼šMQTT åè®® + MaxKB AI æ¥å£ï¼Œå®ç°ç¡¬ä»¶æ™ºèƒ½åŒ–æ§åˆ¶

### 4. å®‰å…¨è®¤è¯ä½“ç³»
**éš¾ç‚¹**ï¼šå¤šè§’è‰²æƒé™ç®¡ç† + é˜²åˆ·éªŒè¯
**è§£å†³**ï¼šJWT + é‚®ç®±éªŒè¯ç  + æ¿€æ´»ç å¤šé‡éªŒè¯


## ğŸ“§ è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€ï¼š[https://github.com/xiuivfbc/backend_of_smart_museum](https://github.com/xiuivfbc/backend_of_smart_museum)
- ä½œè€…ï¼šxiuivfbc